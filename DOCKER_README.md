# ğŸ³ åŸºé‡‘ç›‘æ§åº”ç”¨ Docker éƒ¨ç½²æŒ‡å—

æœ¬æ–‡æ¡£æä¾›åŸºé‡‘ç›‘æ§åº”ç”¨çš„å®Œæ•´ Docker éƒ¨ç½²è¯´æ˜ã€‚

## ğŸ“‹ ç›®å½•ç»“æ„

```
fund_monitor/
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ angular-app/           # Angular å‰ç«¯åº”ç”¨
â”œâ”€â”€ infrastructure/             # åŸºç¡€è®¾æ–½é…ç½®
â”‚   â”œâ”€â”€ nginx/               # Nginx é…ç½®
â”‚   â”œâ”€â”€ postgres/            # PostgreSQL é…ç½®
â”‚   â”œâ”€â”€ redis/               # Redis é…ç½®
â”‚   â”œâ”€â”€ influxdb/            # InfluxDB é…ç½®
â”‚   â””â”€â”€ traefik/             # Traefik é…ç½®
â”œâ”€â”€ docker-compose.*.yml       # Docker Compose é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile               # Docker é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ Makefile                # æ„å»ºå’Œéƒ¨ç½²è„šæœ¬
â””â”€â”€ deploy.sh               # éƒ¨ç½²è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- Docker 20.10+
- Docker Compose 2.0+
- Git
- Make (å¯é€‰ï¼Œä½†æ¨è)

### 2. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd fund_monitor
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡ï¼ˆæ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰
nano .env
```

### 4. ä¸€é”®éƒ¨ç½²

#### å¼€å‘ç¯å¢ƒéƒ¨ç½²
```bash
# æ–¹æ³•1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh init --dev
./deploy.sh start --dev

# æ–¹æ³•2: ä½¿ç”¨ Makefile
make init
make dev
```

#### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```bash
# æ–¹æ³•1: ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh init --prod
./deploy.sh start --prod

# æ–¹æ³•2: ä½¿ç”¨ Makefile
make init
make prod
```

### 5. è®¿é—®åº”ç”¨

- **å¼€å‘ç¯å¢ƒ**: http://localhost:4200
- **ç”Ÿäº§ç¯å¢ƒ**: http://localhost

## ğŸ”§ è¯¦ç»†é…ç½®

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹å…³é”®å˜é‡ï¼š

```bash
# åº”ç”¨é…ç½®
NODE_ENV=production
API_BASE_URL=http://localhost:8000
WS_URL=ws://localhost:8000

# ç«¯å£é…ç½®
FRONTEND_PORT=4200
BACKEND_PORT=8000
POSTGRES_PORT=5432
REDIS_PORT=6379

# æ•°æ®åº“é…ç½®
POSTGRES_DB=fund_monitor
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_password

# Redis é…ç½®
REDIS_PASSWORD=your_redis_password

# InfluxDB é…ç½®
INFLUX_USER=admin
INFLUX_PASSWORD=admin123
INFLUX_ORG=fund-monitor
INFLUX_BUCKET=fund_data
```

### Docker Compose é…ç½®

é¡¹ç›®æä¾›å¤šä¸ª Docker Compose é…ç½®æ–‡ä»¶ï¼š

#### å¼€å‘ç¯å¢ƒ (`docker-compose.dev.yml`)
```yaml
# åŒ…å«å¼€å‘ç¯å¢ƒæ‰€éœ€çš„æœåŠ¡
# - å‰ç«¯åº”ç”¨ï¼ˆçƒ­é‡è½½æ”¯æŒï¼‰
# - åç«¯æœåŠ¡ï¼ˆå¼€å‘ç‰ˆæœ¬ï¼‰
# - æ•°æ®åº“ï¼ˆå¼€å‘ç‰ˆæœ¬ï¼‰
# - ç¼“å­˜æœåŠ¡ï¼ˆå¼€å‘ç‰ˆæœ¬ï¼‰
# - æ—¶é—´åºåˆ—æ•°æ®åº“ï¼ˆå¼€å‘ç‰ˆæœ¬ï¼‰
```

#### ç”Ÿäº§ç¯å¢ƒ (`docker-compose.prod.yml`)
```yaml
# åŒ…å«ç”Ÿäº§ç¯å¢ƒæ‰€éœ€çš„æœåŠ¡
# - å‰ç«¯åº”ç”¨ï¼ˆç”Ÿäº§ç‰ˆæœ¬ï¼‰
# - è´Ÿè½½å‡è¡¡å™¨
# - æ•°æ®åº“ï¼ˆç”Ÿäº§ç‰ˆæœ¬ï¼‰
# - ç¼“å­˜æœåŠ¡ï¼ˆç”Ÿäº§ç‰ˆæœ¬ï¼‰
# - æ—¶é—´åºåˆ—æ•°æ®åº“ï¼ˆç”Ÿäº§ç‰ˆæœ¬ï¼‰
# - ç›‘æ§æœåŠ¡ï¼ˆPrometheusã€Grafanaï¼‰
# - æ—¥å¿—æ”¶é›†ï¼ˆFluentdï¼‰
```

#### å‰ç«¯æœåŠ¡ (`docker-compose.frontend.yml`)
```yaml
# ä»…åŒ…å«å‰ç«¯æœåŠ¡åŠå…¶ä¾èµ–
# é€‚åˆç‹¬ç«‹éƒ¨ç½²å‰ç«¯åº”ç”¨
```

## ğŸ—ï¸ Dockerfile è¯´æ˜

### å¤šé˜¶æ®µæ„å»º

Dockerfile é‡‡ç”¨å¤šé˜¶æ®µæ„å»ºç­–ç•¥ï¼š

1. **æ„å»ºé˜¶æ®µ**: æ„å»ºåº”ç”¨
2. **ç”Ÿäº§é˜¶æ®µ**: ä½¿ç”¨ Nginx éƒ¨ç½²
3. **å¼€å‘é˜¶æ®µ**: æ”¯æŒçƒ­é‡è½½
4. **æµ‹è¯•é˜¶æ®µ**: è¿è¡Œå•å…ƒæµ‹è¯•
5. **åˆ†æé˜¶æ®µ**: æ„å»ºåˆ†æå’Œä»£ç æ£€æŸ¥

### ç”Ÿäº§ä¼˜åŒ–

- ä½¿ç”¨ Alpine Linux å‡å°é•œåƒå¤§å°
- éroot ç”¨æˆ·è¿è¡Œæå‡å®‰å…¨æ€§
- å¤šé˜¶æ®µæ„å»ºå‡å°æœ€ç»ˆé•œåƒ
- å¯ç”¨ Gzip å‹ç¼©
- é…ç½®ç¼“å­˜ç­–ç•¥
- å¥åº·æ£€æŸ¥æœºåˆ¶

## ğŸ› ï¸ å‘½ä»¤å‚è€ƒ

### Makefile å‘½ä»¤

```bash
# å¼€å‘ç¯å¢ƒ
make dev              # å¯åŠ¨å¼€å‘ç¯å¢ƒ
make build-dev         # æ„å»ºå¼€å‘é•œåƒ
make stop-dev          # åœæ­¢å¼€å‘ç¯å¢ƒ
make logs-dev          # æŸ¥çœ‹å¼€å‘ç¯å¢ƒæ—¥å¿—

# ç”Ÿäº§ç¯å¢ƒ
make prod              # å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
make build-prod        # æ„å»ºç”Ÿäº§é•œåƒ
make stop-prod         # åœæ­¢ç”Ÿäº§ç¯å¢ƒ
make logs-prod          # æŸ¥çœ‹ç”Ÿäº§ç¯å¢ƒæ—¥å¿—

# é€šç”¨å‘½ä»¤
make build             # æ„å»ºåº”ç”¨
make test              # è¿è¡Œæµ‹è¯•
make lint              # ä»£ç æ£€æŸ¥
make clean             # æ¸…ç†æ„å»ºæ–‡ä»¶
make logs              # æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
make stop              # åœæ­¢æ‰€æœ‰æœåŠ¡
make status            # æŸ¥çœ‹æœåŠ¡çŠ¶æ€

# Docker ç®¡ç†
make docker-clean      # æ¸…ç†å®¹å™¨å’Œé•œåƒ
make docker-prune      # æ¸…ç†æœªä½¿ç”¨èµ„æº
```

### éƒ¨ç½²è„šæœ¬å‘½ä»¤

```bash
# åˆå§‹åŒ–é¡¹ç›®
./deploy.sh init          # åˆå§‹åŒ–é¡¹ç›®é…ç½®

# æ„å»ºå’Œéƒ¨ç½²
./deploy.sh build          # æ„å»ºé•œåƒ
./deploy.sh start           # å¯åŠ¨æœåŠ¡
./deploy.sh stop            # åœæ­¢æœåŠ¡
./deploy.sh restart         # é‡å¯æœåŠ¡

# ç¯å¢ƒåˆ‡æ¢
./deploy.sh --dev           # å¼€å‘ç¯å¢ƒ
./deploy.sh --prod          # ç”Ÿäº§ç¯å¢ƒ

# ç›‘æ§å’Œå¥åº·æ£€æŸ¥
./deploy.sh health          # å¥åº·æ£€æŸ¥
./deploy.sh status          # æŸ¥çœ‹çŠ¶æ€
./deploy.sh logs            # æŸ¥çœ‹æ—¥å¿—
```

## ğŸ³ Docker Compose ä½¿ç”¨

### å¯åŠ¨ç‰¹å®šæœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# å¯åŠ¨ç‰¹å®šæœåŠ¡
docker-compose up -d frontend

# ä½¿ç”¨ç‰¹å®šé…ç½®æ–‡ä»¶
docker-compose -f docker-compose.prod.yml up -d

# ä½¿ç”¨ç‰¹å®š profile
docker-compose --profile prod up -d
```

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡
docker-compose ps frontend

# æŸ¥çœ‹æœåŠ¡èµ„æºä½¿ç”¨
docker stats
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs frontend

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
docker-compose logs -f frontend

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
docker-compose logs --tail=100 frontend
```

### åœæ­¢å’Œæ¸…ç†

```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down

# åœæ­¢å¹¶åˆ é™¤å®¹å™¨å’Œå·
docker-compose down -v

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up --build

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep :4200

# ä¿®æ”¹ç«¯å£é…ç½®
vim .env
```

#### 2. å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs frontend

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps frontend

# é‡å¯å®¹å™¨
docker-compose restart frontend
```

#### 3. é•œåƒæ„å»ºå¤±è´¥
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
docker builder prune -f

# é‡æ–°æ„å»º
docker-compose build --no-cache
```

#### 4. å‰ç«¯åº”ç”¨æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls

# æ£€æŸ¥ç«¯å£æ˜ å°„
docker port frontend
```

#### 5. èµ„æºåŠ è½½å¤±è´¥
```bash
# æ£€æŸ¥é™æ€æ–‡ä»¶
docker exec frontend ls -la /usr/share/nginx/html

# æ£€æŸ¥ nginx é…ç½®
docker exec frontend cat /etc/nginx/nginx.conf

# é‡æ–°åŠ è½½é…ç½®
docker exec frontend nginx -s reload
```

### å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€
make health

# æ£€æŸ¥å‰ç«¯æœåŠ¡
curl -f http://localhost:4200/health

# æ£€æŸ¥ API æœåŠ¡
curl -f http://localhost:8000/health
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### ç”Ÿäº§ç¯å¢ƒç›‘æ§

ç”Ÿäº§ç¯å¢ƒåŒ…å«å®Œæ•´çš„ç›‘æ§æ ˆï¼š

- **Prometheus**: æŒ‡æ ‡æ”¶é›†
- **Grafana**: æ•°æ®å¯è§†åŒ–
- **Fluentd**: æ—¥å¿—æ”¶é›†

è®¿é—®åœ°å€ï¼š
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000

### æ—¥å¿—ç®¡ç†

æ—¥å¿—æ–‡ä»¶ä½ç½®ï¼š
- Nginx æ—¥å¿—: `/var/log/nginx/`
- åº”ç”¨æ—¥å¿—: `./logs/`
- Docker æ—¥å¿—: `docker logs <container>`

## ğŸ”’ æ›´æ–°éƒ¨ç½²

### æ›´æ–°åº”ç”¨ä»£ç 

```bash
# å¼€å‘ç¯å¢ƒ - çƒ­é‡è½½è‡ªåŠ¨ç”Ÿæ•ˆ
# ä¿®æ”¹ä»£ç åä¼šè‡ªåŠ¨é‡æ–°æ„å»º

# ç”Ÿäº§ç¯å¢ƒ - éœ€è¦æ‰‹åŠ¨æ›´æ–°
./deploy.sh build --prod
./deploy.sh stop-prod
./deploy.sh start --prod
```

### æ›´æ–°é…ç½®

```bash
# æ›´æ–°ç¯å¢ƒå˜é‡
vim .env

# é‡æ–°æ„å»ºå’Œéƒ¨ç½²
./deploy.sh build --prod
./deploy.sh restart
```

## ğŸ” å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
   - ä½¿ç”¨å¼ºå¯†ç 
   - é…ç½® HTTPS
   - å®šæœŸæ›´æ–°åŸºç¡€é•œåƒ

2. **ç½‘ç»œå®‰å…¨**ï¼š
   - ä»…æš´éœ²å¿…è¦ç«¯å£
   - ä½¿ç”¨é˜²ç«å¢™
   - å®šæœŸæ‰«ææ¼æ´

3. **æ•°æ®å®‰å…¨**ï¼š
   - å®šæœŸå¤‡ä»½æ•°æ®
   - ä½¿ç”¨åŠ å¯†ä¼ è¾“
   - é™åˆ¶è®¿é—®æƒé™

## ğŸ“ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯å®¹å™¨    â”‚    â”‚   åç«¯å®¹å™¨    â”‚    â”‚   æ•°æ®åº“å®¹å™¨  â”‚
â”‚  (çƒ­é‡è½½)     â”‚    â”‚   (å¼€å‘ç‰ˆæœ¬)    â”‚    â”‚  (å¼€å‘ç‰ˆæœ¬)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ï¿½    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Docker    â”‚      ç½‘ç»œ       â”‚
    â”‚  Compose    â”‚     fund-monitor   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç”Ÿäº§ç¯å¢ƒæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      è´Ÿè½½å‡è¡¡       â”‚        å‰ç«¯æœåŠ¡        â”‚      æ•°æ®åº“é›†ç¾¤      â”‚
â”‚    (Traefik)        â”‚        (Nginx)         â”‚      (PostgreSQL)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                     â”‚                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                    Docker Compose                     â”‚
    â”‚                  fund-monitor-network                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
3. ç¡®ä¿ç³»ç»Ÿæ»¡è¶³ä¾èµ–è¦æ±‚
4. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œç¯å¢ƒé…ç½®

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹ [LICENSE](./LICENSE) æ–‡ä»¶ã€‚